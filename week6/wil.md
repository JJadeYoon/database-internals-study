# **B-Tree κµ¬ν„ (νμ΄μ§€ ν—¤λ”, κ²€μƒ‰, μ „ν)**


## 1. Page Headerμ™€ Magic Numbers


### 1.1 Page Headerμ μ—­ν• 

νμ΄μ§€ ν—¤λ”λ” ν•΄λ‹Ή νμ΄μ§€μ— λ€ν• λ©”νƒ€λ°μ΄ν„°λ¥Ό μ €μ¥ν•λ” κ³µκ°„μ΄λ‹¤. λ„¤λΉ„κ²μ΄μ…, μ μ§€λ³΄μ, μµμ ν™”μ— μ‚¬μ©λλ” μ •λ³΄λ“¤μ΄ ν¬ν•¨λλ‹¤.

- νμ΄μ§€ λ‚΄μ©κ³Ό λ μ΄μ•„μ›ƒμ„ μ„¤λ…ν•λ” **ν”λκ·Έ**
- νμ΄μ§€ λ‚΄ **μ…€μ κ°μ**
- λΉ κ³µκ°„μ„ ν‘μ‹ν•λ” μƒν•/ν•ν• **μ¤ν”„μ…‹** (μ…€ μ¤ν”„μ…‹κ³Ό λ°μ΄ν„° μ¶”κ°€μ©)
- **λ©”νƒ€λ°μ΄ν„°**

**νμ΄μ§€, μ…€, λΈ”λ­μ κ³„μΈµμ  κ΄€κ³„**

```
π”Έ μ…€ (Cell) - μ‹¤μ  λ°μ΄ν„° μ €μ¥ λ‹¨μ„
    β†“ μ—¬λ¬ μ…€μ΄ λ¨μ—¬μ„
π”Έ νμ΄μ§€ (Page) - λ…Όλ¦¬μ  κ΄€λ¦¬ λ‹¨μ„  
    β†“ νμ΄μ§€κ°€ λ¬Όλ¦¬μ μΌλ΅ μ €μ¥λλ” κ³³
π”Έ λΈ”λ­ (Block) - λ¬Όλ¦¬μ  λ””μ¤ν¬ λ‹¨μ„
```

- λΈ”λ­ - λ¬Όλ¦¬μ  κΈ°λ°
    - λ””μ¤ν¬μ μµμ† I/O λ‹¨μ„
    - λ°μ΄ν„°λ² μ΄μ¤κ°€ μ§μ ‘ μ μ–΄ν•  μ μ—†λ” λ¬Όλ¦¬μ  μ μ•½
- νμ΄μ§€ - λ…Όλ¦¬μ  κ΄€λ¦¬ λ‹¨μ„
    - λ°μ΄ν„°λ² μ΄μ¤κ°€ κ΄€λ¦¬ν•λ” λ…Όλ¦¬μ  λ‹¨μ„
    - μΌλ°μ μΌλ΅ λΈ”λ­ ν¬κΈ°μ λ°°μ (4KB, 8KB, 16KB λ“±)
    - B-Treeμ λ…Έλ“ ν•λ‚κ°€ λ³΄ν†µ ν• νμ΄μ§€μ— λ€μ‘
    - νμ΄μ§€ ν—¤λ” + μ‹¤μ  λ°μ΄ν„° μμ—­μΌλ΅ κµ¬μ„±
- μ…€ - λ°μ΄ν„° μ €μ¥ λ‹¨μ„
    - μ‹¤μ  ν‚¤-κ°’ μμ΄λ‚ μΈλ±μ¤ μ—”νΈλ¦¬λ¥Ό μ €μ¥ν•λ” λ‹¨μ„
    - κ°€λ³€ ν¬κΈ° (ν‚¤μ™€ κ°’μ ν¬κΈ°μ— λ”°λΌ λ‹¬λΌμ§)
    - νμ΄μ§€ λ‚΄μ—μ„ μ‚½μ… μμ„λ€λ΅ λ¬Όλ¦¬μ  μ €μ¥
    - μ…€ ν¬μΈν„°λ¥Ό ν†µν• κ°„μ ‘ μ°Έμ΅°λ΅ λ…Όλ¦¬μ  μμ„ μ μ§€
</aside>

### 1.2 μ‹¤μ  DBMS κµ¬ν„ μ‚¬λ΅€

- **PostgreSQL**: νμ΄μ§€ ν¬κΈ°μ™€ λ μ΄μ•„μ›ƒ λ²„μ „μ„ ν—¤λ”μ— μ €μ¥
- **MySQL InnoDB**: ν™ λ μ½”λ“ μ, λ λ²¨, κΈ°νƒ€ κµ¬ν„λ³„ κ°’λ“¤μ„ μ €μ¥
- **SQLite**: μ…€μ κ°μμ™€ rightmost ν¬μΈν„°λ¥Ό μ €μ¥

### 1.3 Magic Numbers

νμΌμ΄λ‚ νμ΄μ§€ ν—¤λ”μ— λ°°μΉλλ” κ°’μΌλ΅, νμ΄μ§€μ μΆ…λ¥μ™€ λ²„μ „ κ°™μ€ μ •λ³΄λ¥Ό λ‚νƒ€λ‚Έλ‹¤.

- κ²€μ¦κ³Ό λ¬΄κ²°μ„± μ²΄ν¬μ— μ‚¬μ©
    - μ“°κΈ° μ‹ νΉμ • λ°”μ΄νΈ μ‹ν€€μ¤λ¥Ό ν—¤λ”μ— λ°°μΉ (μ: 50 41 47 45 - "PAGE"μ hex)
    - μ½κΈ° μ‹ ν—¤λ”μ 4λ°”μ΄νΈλ¥Ό μμƒ λ°”μ΄νΈ μ‹ν€€μ¤μ™€ λΉ„κµν•μ—¬ κ²€μ¦
    - λλ¤ μ¤ν”„μ…‹μ—μ„ μ •ν™•ν λ§¤μΉ­λ  ν™•λ¥ μ΄ λ§¤μ° λ‚®μ•„ μ¤ν”„μ…‹μ΄ μ¬λ°”λ¥Έμ§€ ν™•μΈ κ°€λ¥

**λ§¤μ§ λ„λ²„κ°€ ν•„μ”ν• μ΄μ **

> *λ°μ΄ν„°λ² μ΄μ¤λ” μ½μ–΄μ¨ λ°μ΄ν„°κ°€ μ •λ§ B-Tree νμ΄μ§€μΈμ§€ μ–΄λ–»κ² ν™•μ‹ ν•  μ μμ„κΉ?*
> 

μƒν™©: λ°μ΄ν„°λ² μ΄μ¤κ°€ νμ΄μ§€ #100μ„ μ½μΌλ ¤κ³  ν•¨

μ •μƒμ μΈ κ²½μ°: νμΌ μ¤ν”„μ…‹ 400KB β†’ [B-Tree νμ΄μ§€ λ°μ΄ν„°]

λ¬Έμ κ°€ λ°μƒν• κ²½μ°: νμΌ μ¤ν”„μ…‹ 400KB β†’ [μ΄λ―Έμ§€ νμΌ λ°μ΄ν„°] (λ‹¤λ¥Έ νμΌμ΄ μ„μ„)

> *νΉλ³„ν• μ„λ…(signature)μ„ νμ΄μ§€ μ‹μ‘ λ¶€λ¶„μ— λ„£μ–΄ ν™•μΈν•μ*
> 

```
IF (νμ΄μ§€ μ²« 4λ°”μ΄νΈ == μμƒ λ§¤μ§ λ„λ²„):
    β†’ μ¬λ°”λ¥Έ νμ΄μ§€μΌ κ°€λ¥μ„±μ΄ λ§¤μ° λ†’μ
ELSE:
    β†’ ν™•μ‹¤ν μλ»λ λ°μ΄ν„° β†’ μ¤λ¥ λ°μƒ
```

</aside>

## 2. Sibling Links


### 2.1 κ°λ…

μΌλ¶€ κµ¬ν„μ—μ„λ” μΆμ° ν•μ  νμ΄μ§€λ¥Ό κ°€λ¦¬ν‚¤λ” μλ°©ν–¥/μ—­λ°©ν–¥ λ§ν¬λ¥Ό μ €μ¥ν•μ—¬, λ¶€λ¨λ΅ λμ•„κ°€μ§€ μ•κ³ λ„ μΈμ ‘ λ…Έλ“λ¥Ό μ°Ύμ„ μ μκ² ν•λ‹¤.

### 2.2 μ¥λ‹¨μ 

**2.2.1 μ¥μ **

- λ¶€λ¨ λ…Έλ“λ¥Ό κ±°μΉμ§€ μ•κ³  μ§μ ‘ ν•μ  λ…Έλ“ μ ‘κ·Ό κ°€λ¥
- κ°™μ€ λ λ²¨μ—μ„μ μμ°¨ μ¤μΊ”μ΄ ν¨μ¨μ 

**2.2.2 λ‹¨μ **

- λ¶„ν• κ³Ό λ³‘ν•© μ—°μ‚°μ‹ λ³µμ΅μ„± μ¦κ°€ - ν•μ  μ¤ν”„μ…‹λ„ ν•¨κ» μ—…λ°μ΄νΈ ν•„μ”
    
    ex. μµμ°μΈ΅μ΄ μ•„λ‹ λ…Έλ“κ°€ λ¶„ν• λ  λ•, μ°μΈ΅ ν•μ μ μ—­λ°©ν–¥ ν¬μΈν„°λ¥Ό μƒλ΅ μƒμ„±λ λ…Έλ“λ΅ μ¬μ„¤μ • ν•„μ”
    

### 2.3 λ™μ‹μ„± κ³ λ ¤μ‚¬ν•­

Sibling linksλ¥Ό μ‚¬μ©ν•λ” κ²½μ° ν•μ  λ…Έλ“μ μ—…λ°μ΄νΈλ΅ μ΄ν•Έ μ¶”κ°€μ μΈ λ½ν‚Ήμ΄ ν•„μ”ν•  μ μλ‹¤. λ¶„ν• /λ³‘ν•©λλ” λ…Έλ“ μ™Έμ—λ„ λ‹¤λ¥Έ λ…Έλ“λ“¤λ„ ν•¨κ» κ³ λ ¤ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ΄λ‹¤.

```
λ¶„ν•  μ „:
[A] β†β†’ [B: ν‚¤1,ν‚¤2,ν‚¤3,ν‚¤4,ν‚¤5] β†β†’ [C]

λ¶„ν•  ν›„:
[A] β†β†’ [B: ν‚¤1,ν‚¤2] β†β†’ [B': ν‚¤3,ν‚¤4,ν‚¤5] β†β†’ [C]

1. λ…Έλ“ B:
   - right_sibling = Cμ μ£Όμ† -> B'μ μ£Όμ†λ΅ λ³€κ²½

2. λ…Έλ“ B' (μƒλ΅ μƒμ„±):  
   - left_sibling = B'μ μ£Όμ†
   - right_sibling = Cμ μ£Όμ†

3. λ…Έλ“ C (ν•μ  λ…Έλ“):
   - left_sibling = Bμ μ£Όμ† β†’ B'μ μ£Όμ†λ΅ λ³€κ²½
```

Sibling linksλ¥Ό μ‚¬μ©ν•¨μΌλ΅, κ΄€λ ¨ μ—†λ” Cλ„ ν•¨κ» μ΅°μ‘ν•΄μ•Ό ν•κ³ , λ½ν‚Ήμ΄ μ¶”κ°€μ μΌλ΅ ν•„μ”ν•λ‹¤.

```
1. λ…Έλ“ B (μ“°κΈ° λ½) - λ‚΄μ© μμ •
2. λ…Έλ“ C (μ“°κΈ° λ½) - left_sibling ν¬μΈν„° λ³€κ²½  
3. λ¶€λ¨ λ…Έλ“ (μ“°κΈ° λ½) - μƒλ΅μ΄ ν‚¤ μ¶”κ°€
```

μ΄λ• λ™μ‹μ— μ—¬λ¬ λ¶„ν• μ΄ μΌμ–΄λ‚λ” κ²½μ° λ°λ“λ½μ΄ λ°μƒν•  μλ„ μλ‹¤.

```
Transaction_1: A β†β†’ B λ¶„ν• 
Transaction_2: B β†β†’ C λ¶„ν• 

λ‘ νΈλμ­μ… λ¨λ‘ λ…Έλ“ Bμ— λ€ν• λ½μ΄ ν•„μ”!
β†’ μμ„ λ¬Έμ μ™€ λ°λ“λ½ κ°€λ¥μ„± μ—¬μ „ν μ΅΄μ¬
```

## 3. Rightmost Pointers μ²λ¦¬


### 3.1 B-Treeμ ν¬μΈν„° λ¶λ³€ μ΅°κ±΄

B-Tree κµ¬λ¶„ ν‚¤λ” μ—„κ²©ν• λ¶λ³€ μ΅°κ±΄μ„ κ°€μ§„λ‹¤.

- νΈλ¦¬λ¥Ό μ„λΈνΈλ¦¬λ΅ λ¶„ν• ν•κ³  νƒμƒ‰ν•λ” λ° μ‚¬μ©
- ν•­μƒ ν‚¤λ³΄λ‹¤ ν¬μΈν„°κ°€ ν•λ‚ λ” λ§μ (Rightmost Pointer)

### 3.2 λ‘ κ°€μ§€ κµ¬ν„ λ°©μ‹

**3.2.1 λ¶„λ¦¬λ μ €μ¥**

- κ° λ¶„λ¦¬ ν‚¤λ§λ‹¤ μμ‹ ν¬μΈν„° λ³΄μ 
- λ§μ§€λ§‰ ν¬μΈν„°λ” λ³„λ„ μ €μ¥ (μ–΄λ–¤ ν‚¤μ™€λ„ μμ„ μ΄λ£¨μ§€ μ•μ)
- SQLiteμ—μ„ μ΄ λ°©μ‹μ„ μ‚¬μ©ν•μ—¬ ν—¤λ”μ— κµ¬ν„

**3.2.2 High Key μ‚¬μ©**

- κ° λ…Έλ“μ— μ¶”κ°€ ν‚¤(K_N+1) μ¶”κ°€
- ν¬μΈν„° P_Nμ΄ κ°€λ¦¬ν‚¤λ” μ„λΈνΈλ¦¬μ— μ €μ¥ κ°€λ¥ν• ν‚¤μ μƒν• μ§€μ •
    - κ²€μƒ‰ κ³µκ°„μ μ°¨μ΄
        
        **κΈ°λ³Έ λ°©μ‹**: +βκΉμ§€ ν™•μ¥
        **High Key λ°©μ‹**: K3μ μƒν•κΉμ§€λ΅ μ ν•
        
- PostgreSQLμ—μ„ Blink-Treesμ©μΌλ΅ μ‚¬μ©

ν¬μΈν„°λ¥Ό μμΌλ΅ μ €μ¥ν•  μ μμ–΄ κ° μ…€μ΄ λ€μ‘λλ” ν¬μΈν„°λ¥Ό κ°€μ§€κ² λλ―€λ΅, rightmost ν¬μΈν„° μ²λ¦¬μ‹ μ—£μ§€ μΌ€μ΄μ¤λ¥Ό κ³ λ ¤ν•  ν•„μ”κ°€ μ¤„μ–΄λ“ λ‹¤.

## 4. Overflow Pages


### 4.1 Overflow Pages

κ³ μ • ν¬κΈ° νμ΄μ§€μ—μ„ κ°€λ³€ ν¬κΈ° κ°’μ„ μ²λ¦¬ν•κΈ° μ„ν• λ©”μ»¤λ‹μ¦μ΄λ‹¤.

**4.1.1 λ¬Έμ  μƒν™©**

- λ…Έλ“ ν¬κΈ°μ™€ νΈλ¦¬ ν¬μ•„μ›ƒμ€ κ³ μ •κ°’
- κ°€λ³€ ν¬κΈ° κ°’μ΄ μ΅΄μ¬ν•  λ• λ²”μ©μ  μµμ κ°’ μ„¤μ •μ΄ μ–΄λ ¤μ›€
- κ°’μ΄ ν΄ κ²½μ° νμ΄μ§€μ— λ‡ κ°λ§ λ“¤μ–΄κ°€κ³ , μ‘μ„ κ²½μ° κ³µκ°„ λ‚­λΉ„ λ°μƒ

**4.1.2 ν•΄κ²° λ°©μ•**

- κΈ°λ³Έ νμ΄μ§€ ν¬κΈ° 4Kμ—μ„ μ‹μ‘
- λ°μ΄ν„° ν¬κΈ°κ°€ 4Kλ¥Ό μ΄κ³Όν•λ©΄ 4K λ‹¨μ„λ΅ ν™•μ¥ νμ΄μ§€ ν• λ‹Ή
- μ›λ³Έ νμ΄μ§€μ—μ„ ν™•μ¥ νμ΄μ§€λ΅ λ§ν¬ μ—°κ²°
- μ΄λ¬ν• μ—°κ²°λ νμ΄μ§€ ν™•μ¥μ„ **overflow pages**λΌ λ…λ…

**4.1.3 μ‹¤μ  κµ¬ν„**

- λ€λ¶€λ¶„μ B-Tree κµ¬ν„μ€ κ³ μ •λ payload λ°”μ΄νΈλ§ B-Tree λ…Έλ“μ— μ§μ ‘ μ €μ¥
- λ‚λ¨Έμ§€λ” overflow νμ΄μ§€λ΅ λ¶„ν•  (max_payload_sizeλ΅ κ³„μ‚°)
- ν•­μƒ μµμ†ν•μ μ—¬μ  κ³µκ°„ λ³΄μ¥

## 5. Binary Search κµ¬ν„


### 5.1 κΈ°λ³Έ μ΄μ§„ νƒμƒ‰

λ…Έλ“ λ‚΄ ν‚¤ μ„μΉλ¥Ό μ°ΎκΈ° μ„ν•΄ μ΄μ§„ νƒμƒ‰μ„ μ‚¬μ©ν•λ‹¤. μ •λ ¬λ λ°μ΄ν„°μ—μ„λ§ μ‘λ™ν•λ―€λ΅ ν‚¤ μμ„ μ μ§€κ°€ ν•„μμ μ΄λ‹¤.

- μ •λ ¬λ λ°°μ—΄κ³Ό νƒμƒ‰ ν‚¤λ¥Ό μ…λ ¥λ°›μ•„ μ«μ λ°ν™
- μ–‘μ λ°ν™: ν‚¤ λ°κ²¬, λ°°μ—΄μ—μ„μ μ„μΉ λ…μ‹
- μμ λ°ν™: ν‚¤ λ―Έμ΅΄μ¬, **μ‚½μ… μ§€μ ** μ κ³µ
    
    μμμ μ λ“κ°’μ€ νƒμƒ‰ ν‚¤λ¥Ό μμ„ λ³΄μ΅΄ν•λ©° μ‚½μ…ν•  μ μλ” μ£Όμ–΄μ§„ ν‚¤λ³΄λ‹¤ ν° μ²« λ²μ§Έ μ”μ†μ μΈλ±μ¤λ¥Ό λ‚νƒ€λƒ„
    

### 5.2 B-Treeμ—μ„μ νΉμμ„±

λ°μ΄ν„°λ” λ¦¬ν”„μ—λ§ μ΅΄μ¬ν•κΈ° λ•λ¬Έμ— μƒμ„ λ λ²¨ νƒμƒ‰μ—μ„λ” μ •ν™•ν• λ§¤μΉλ³΄λ‹¤λ” **νƒμƒ‰ λ°©ν–¥**μ΄ μ¤‘μ”ν•λ‹¤.

- νƒμƒ‰ ν‚¤λ³΄λ‹¤ ν° μ²« λ²μ§Έ κ°’μ„ μ°Ύμ•„μ•Ό ν•¨
- ν•΄λ‹Ήν•λ” μμ‹ λ§ν¬λ¥Ό λ”°λΌ μ—°κ΄€λ μ„λΈνΈλ¦¬λ΅ μ΄λ™

### 5.3 Indirection Pointers(κ°„μ ‘ ν¬μΈν„°)λ¥Ό μ‚¬μ©ν• μ΄μ§„ νƒμƒ‰

B-Tree νμ΄μ§€μ μ…€μ€ μ‚½μ… μμ„λ΅ μ €μ¥λλ©°, μ…€ μ¤ν”„μ…‹λ§μ΄ λ…Όλ¦¬μ  μ”μ† μμ„λ¥Ό μ μ§€ν•λ‹¤.

1. μ¤‘κ°„ μ…€ μ¤ν”„μ…‹ μ„ νƒ
2. ν¬μΈν„°λ¥Ό λ”°λΌ μ…€ μ„μΉ ν™•μΈ
3. μ…€μ ν‚¤μ™€ νƒμƒ‰ ν‚¤ λΉ„κµ
4. νƒμƒ‰μ„ μ™Όμ½/μ¤λ¥Έμ½μΌλ΅ κ³„μ†ν• μ§€ κ²°μ •
5. νƒμƒ‰ μ”μ†λ‚ μ‚½μ… μ§€μ μ„ μ°Ύμ„ λ•κΉμ§€ μ¬κ·€μ  λ°λ³µ

## 6. Propagating Splits and Merges


### 6.1 μƒμ„ λ λ²¨λ΅μ μ „ν

λ¶„ν• κ³Ό λ³‘ν•©μ€ μƒμ„ λ λ²¨λ΅ μ „νλ  μ μκ³ , μ΄λ¥Ό μ„ν•΄ λ¶„ν• ν•λ” λ¦¬ν”„λ‚ λ³‘ν•©ν•λ” λ¦¬ν”„ μμ—μ„ λ£¨νΈ λ…Έλ“κΉμ§€μ κ²½λ΅λ¥Ό κ±°μ¬λ¬ μ¬λΌκ° μ μμ–΄μ•Ό ν•λ‹¤.

### 6.2 Parent Pointers vs Breadcrumbs

**6.2.1 Parent Pointers**

- B-Tree λ…Έλ“μ— λ¶€λ¨ λ…Έλ“ ν¬μΈν„° ν¬ν•¨
- ν•μ„ λ λ²¨ νμ΄μ§€λ” μƒμ„ λ λ²¨μ—μ„ μ°Έμ΅°λ  λ• ν•­μƒ νμ΄μ§•λ¨
- λ””μ¤ν¬μ— μ •λ³΄λ¥Ό μ μ§€ν•  ν•„μ” μ—†μ
- λ¶€λ¨ λ³€κ²½μ‹λ§λ‹¤ μ—…λ°μ΄νΈ ν•„μ” (λ¶„ν• , λ³‘ν•©, λ¦¬λ°Έλ°μ‹± μ‹)

**6.2.2 Breadcrumbs**

- λ£¨νΈμ—μ„ λ€μƒ λ¦¬ν”„ λ…Έλ“κΉμ§€μ κ²½λ΅μƒ λ…Έλ“λ“¤μ„ μ¶”μ 
- λ¶„ν• μ΄λ‚ λ³‘ν•© μ „νμ‹ μ—­μμΌλ΅ μ΄λ¥Ό λ°±νΈλν‚Ήν•μ—¬ μ‚¬μ©
- λ©”λ¨λ¦¬μ μ¤νƒμ— κ²½λ΅λ¥Ό μ €μ¥
- PostgreSQLμ—μ„ BTStackμΌλ΅ λ‚΄λ¶€ μ°Έμ΅°
